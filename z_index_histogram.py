import pylidc as pl
import matplotlib.pyplot as plt
pid = 'LIDC-IDRI-0011'

scan = pl.query(pl.Scan).filter(pl.Scan.patient_id == pid).first()
anns = scan.cluster_annotations()

z_list = {}

z_length = []   #result for 201 patients : [17.5, 33.75, 17.5, 15.0, 7.5, 10.0, 3.75, 2.5, 5.0, 2.5, 2.5, 0.0, 7.5, 2.5, 22.5, 27.5, 2.5, 2.5, 2.5, 3.75, 3.75, 3.75, 3.75, 7.5, 5.0, 2.5, 2.5, 2.5, 2.5, 2.5, 7.5, 5.0, 7.5, 5.0, 5.0, 2.5, 7.5, 5.0, 5.0, 5.0, 5.0, 7.5, 5.0, 0.0, 5.0, 2.5, 7.5, 20.00000800000001, 12.5, 17.5, 10.0, 7.5, 2.5, 5.0, 2.5, 12.5, 3.75, 2.5, 7.500000000000014, 2.5, 12.5, 25.0, 15.0, 6.25, 2.5, 7.5, 10.0, 25.0, 22.5, 2.5, 10.0, 5.0, 2.5, 3.75, 1.25, 2.5, 7.5, 5.0, 0.0, 5.0, 7.5, 2.5, 2.5, 22.5, 5.0, 2.5, 2.5, 0.0, 5.0, 5.0, 17.5, 5.0, 12.5, 2.5, 5.0, 3.75, 6.25, 10.0, 5.0, 2.5, 5.0, 3.75, 3.75, 2.5, 6.25, 5.0, 2.5, 2.5, 0.0, 12.5, 2.5, 5.0, 2.5, 0.0, 5.0, 2.5, 2.5, 2.5, 2.5, 0.0, 5.0, 2.5, 5.0, 5.0, 12.5, 15.0, 10.0, 25.0, 7.5, 5.0, 2.5, 5.0, 5.0, 5.0, 5.0, 10.0, 5.0, 5.0, 15.0, 10.0, 7.5, 5.0, 7.5, 5.0, 2.5, 2.5, 10.0, 5.0, 7.5, 6.25, 2.5, 5.0, 2.5, 2.5, 2.5, 0.0, 2.5, 2.5, 10.0, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 5.0, 2.5, 20.0, 2.5, 10.0, 12.5, 6.25, 12.5, 20.0, 5.0, 12.5, 2.5, 5.0, 2.5, 2.5, 7.5, 5.0, 2.5, 8.75, 2.5, 1.25, 25.0, 12.5, 2.5, 17.5, 7.5, 10.0, 7.5, 2.5, 17.5, 2.5, 20.0, 10.0, 55.0, 0.0, 7.5, 5.0, 30.0, 2.5, 7.5, 12.5, 5.0, 22.5, 20.0, 1.25, 5.0, 15.0, 1.5, 8.75, 3.75, 5.0, 2.5, 5.0, 6.25, 7.5, 2.5, 10.0, 11.25, 14.0, 0.0, 12.0, 2.5, 2.5, 0.0, 23.75, 5.0, 2.5, 10.0, 12.5, 2.5, 23.75, 6.25, 6.25, 6.25, 6.25, 22.5, 7.5, 15.0, 15.0, 3.0, 21.0, 12.0, 11.25, 18.75, 5.0, 20.0, 15.0, 2.5, 2.5, 4.0, 2.0, 2.0, 4.0, 4.0, 4.0, 1.25, 2.5, 7.5, 17.5, 2.5, 2.5, 3.75, 3.75, 22.5, 5.0, 1.25, 7.5, 7.5, 11.25, 15.0, 5.0, 5.0, 3.75, 2.5, 5.0, 5.0, 23.0, 16.0, 2.0, 10.0, 2.5, 5.0, 6.0, 5.0, 7.5, 5.0, 1.25, 3.0, 2.5, 0.0, 3.0, 0.0, 12.0, 2.5, 5.0, 2.0, 4.0, 4.0, 2.0, 2.0, 2.0, 4.0, 4.0, 6.0, 15.0, 7.5, 10.0, 3.0, 3.0, 2.5, 15.0, 7.5, 5.0, 2.5, 10.0, 7.5, 2.5, 6.25, 21.0, 0.0, 15.0, 9.0, 3.75, 3.75, 3.75, 6.25, 5.0, 2.5, 11.0, 6.0, 10.0, 6.0, 16.0, 10.0, 13.75, 5.0, 5.0, 5.0, 2.5, 2.5, 2.5, 0.0, 5.0, 7.5, 2.5, 5.0, 2.5, 2.5, 0.0, 5.0, 5.0, 5.0, 7.5, 1.25, 3.75, 2.5, 2.5, 5.0, 36.0, 3.75, 5.0, 5.0, 6.25, 11.25, 2.5, 11.25, 1.25, 6.25, 7.5, 0.0, 3.75, 2.5, 6.25, 6.25, 7.5, 3.75, 3.75, 13.0, 7.0, 5.0, 2.5, 6.0, 6.0, 0.0, 15.0, 0.0, 3.0, 6.25, 15.0, 6.0, 9.0, 3.0, 7.5, 5.0, 2.5, 7.5, 2.5, 5.0, 0.0, 3.0, 3.0, 6.0, 6.0, 3.0, 15.0, 3.0, 3.0, 2.5, 10.0, 7.5, 35.0, 35.0, 22.5, 17.5, 2.5, 8.0, 27.0, 6.0, 5.0, 3.0, 4.0, 5.0, 2.0, 5.0, 4.0, 2.5, 7.5, 2.5, 5.0, 7.5, 2.5, 7.5, 0.0, 17.5, 6.0, 2.0, 4.0, 2.0, 4.0, 4.0, 0.0, 0.0, 12.5, 12.5, 0.0, 7.5, 5.0, 2.5, 5.0, 0.0, 0.0, 2.5, 6.0, 9.0, 6.0, 7.5, 12.5, 12.5, 3.0, 21.0, 2.5, 9.0, 0.0, 7.5, 2.5, 6.25, 5.0, 5.0, 12.5, 12.5, 10.0, 10.0, 5.0, 6.25, 3.75, 10.0, 3.75, 2.5, 7.5, 20.0, 5.0, 8.75, 13.75, 10.0, 6.25, 6.25, 5.0, 3.75, 7.5, 3.75, 15.0, 2.5, 35.0, 2.5, 2.5, 5.0, 5.0, 6.25, 2.5, 8.75, 6.25, 20.0, 16.25, 20.0, 5.0, 5.0, 7.5, 0.0, 0.0, 17.5, 5.0, 7.5, 6.25, 1.25, 1.25, 7.5, 0.0, 12.5, 7.5, 5.0, 5.0, 2.5, 0.0, 2.5, 2.5, 5.0, 2.5, 5.0, 3.75, 12.5, 10.0, 15.0, 7.5, 7.5, 5.0, 10.0, 12.5, 2.5, 2.5, 7.5, 10.0, 22.5, 7.5, 10.0, 5.0, 2.5, 2.5, 5.0, 10.0, 2.5, 7.5, 5.0, 20.0, 12.5, 2.5, 2.5, 2.5, 17.5, 2.5, 2.5, 0.0, 25.0, 5.0, 5.0, 5.0, 2.5, 2.5, 2.5, 22.5, 15.0, 15.0, 2.5, 2.5, 6.25, 3.75, 3.75, 5.0, 15.0, 17.5, 12.5, 0.0, 7.5, 7.5, 15.0, 12.5, 17.5, 7.5, 10.0, 2.5, 6.25, 2.5, 1.25, 13.75, 2.5, 0.0]

for i in range(1,201):
    if i<10:
        s = '000'+str(i)
    elif i<100:
        s = '00'+str(i)
    else:
        s = '0'+str(i)
    pid = 'LIDC-IDRI-{}'.format(s)
    scan = pl.query(pl.Scan).filter(pl.Scan.patient_id == pid).first()
    nodules = scan.cluster_annotations()
    for anns in nodules:
        z_length.append(anns[0].contour_slice_zvals[-1] - anns[0].contour_slice_zvals[0])
        for z in anns[0].contour_slice_zvals:

            z //=1
            if z>0 or z<-400:
                continue
            if z in z_list.keys():
                z_list[z] += 1
            else:
                z_list[z] = 1
            if z > 1000:
                print(pid)

plt.bar(z_list.keys(), z_list.values())
plt.title('number of nodules for z-value')
plt.xlabel('z-value')
plt.ylabel('count')
plt.show()
plt.hist(z_length,edgecolor='black', linewidth=1.2)
plt.show()